<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rirods">
<title>Use iRODS metadata • rirods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use iRODS metadata">
<meta property="og:description" content="rirods">
<meta property="og:image" content="https://irods.github.io/irods_client_library_rirods/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rirods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/demo.html">Use iRODS demo</a>
    <a class="dropdown-item" href="../articles/develop.html">Developing rirods</a>
    <a class="dropdown-item" href="../articles/icommands.html">rirods vs iCommands</a>
    <a class="dropdown-item" href="../articles/local-irods.html">Accessing data locally and in iRODS</a>
    <a class="dropdown-item" href="../articles/metadata.html">Use iRODS metadata</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-2-0/">Version 0.2.0</a>
    <a class="external-link dropdown-item" href="https://fairelabs.github.io/iRODS4R/posts/rirods-0-1-1/">Version 0.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/irods/irods_client_library_rirods/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use iRODS metadata</h1>
                        <h4 data-toc-skip class="author">Mariana
Montes</h4>
            
            <h4 data-toc-skip class="date">2024-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/irods/irods_client_library_rirods/blob/HEAD/vignettes/metadata.Rmd" class="external-link"><code>vignettes/metadata.Rmd</code></a></small>
      <div class="d-none name"><code>metadata.Rmd</code></div>
    </div>

    
    
<p>In this vignette we’ll look at the use of metadata with the
<a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> package. This guide is meant to be useful both for
users familiar with iRODS that want to understand the R client better,
and for R users who are not familiar with iRODS metadata.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>In the background we have already started an iRODS session in the
demo server; our home directory “/tempZone/home/rods” is empty, as
<code><a href="../reference/ils.html">ils()</a></code> shows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For illustration purposes, we’ll create some data objects
(i.e. files). First, we simulate a study with a small dataframe and a
linear model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">fake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, mean <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fake_data</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">fake_data</span><span class="op">$</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, sd <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">fake_data</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code></pre></div>
<p>Then we store the dataframe as csv and the linear model as RDS
objects on iRODS. The csv file must be stored locally first, but the
other two can be directly streamed to iRODS.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_path</span> <span class="op">&lt;-</span> <span class="st">"data.csv"</span></span>
<span><span class="va">lm_path</span> <span class="op">&lt;-</span> <span class="st">"analysis/linear_model.rds"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">fake_data</span>, <span class="va">data_path</span><span class="op">)</span> <span class="co"># write locally</span></span>
<span><span class="fu"><a href="../reference/iput.html">iput</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="va">data_path</span><span class="op">)</span> <span class="co"># transfer to iRODS</span></span>
<span><span class="fu"><a href="../reference/imkdir.html">imkdir</a></span><span class="op">(</span><span class="st">"analysis"</span><span class="op">)</span> <span class="co"># create directory</span></span>
<span><span class="co"># save directly as rds</span></span>
<span><span class="fu"><a href="../reference/iput.html">isaveRDS</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">lm_path</span><span class="op">)</span></span></code></pre></div>
<p>If we add <code>metadata=TRUE</code> to the <code><a href="../reference/ils.html">ils()</a></code> call,
we will see that these new data objects have no metadata attached to
them.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span>metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="st">"analysis"</span>, metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata-in-irods">Metadata in iRODS<a class="anchor" aria-label="anchor" href="#metadata-in-irods"></a>
</h2>
<p>In iRODS, metadata is registered as attribute name-value-unit triples
(<em>aka</em> AVUs) attached to collections or data objects. To add an
AVU with <a href="https://github.com/irods/irods_client_library_rirods" class="external-link">rirods</a> we can use the <code><a href="../reference/imeta.html">imeta()</a></code>
function, which takes three main arguments: the path to the collection
or data object, its entity type (“data_object”, which is the default, or
“collection”), and a list of operations. These operations themselves
must be named lists or vectors with an <code>operation</code> —which
indicates whether we want to “add” or “remove” an AVU— and the values
for the attribute (name), value and, optionally, units.</p>
<p>For example, let’s say we want to include the number of rows of our
<code>fake_data</code> as a metadata field “nrow”. We could do something
like this<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;filter_ils()&lt;/code&gt; is a custom function to filter
the output of &lt;code&gt;&lt;a href="../reference/ils.html"&gt;ils()&lt;/a&gt;&lt;/code&gt; based on the path. The code can be
found in &lt;code&gt;&lt;a href="../articles/icommands.html"&gt;vignette("icommands")&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;'><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/imeta.html">imeta</a></span><span class="op">(</span><span class="va">data_path</span>, operations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"add"</span>, attribute <span class="op">=</span> <span class="st">"nrow"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fake_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">filter_ils</span><span class="op">(</span><span class="va">data_path</span>, <span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span>metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also have several AVUs with the same attribute name and
different values or units for the same item. For example, we might want
to code the number of rows and columns as a metadata field “size”. Since
the old AVU is not necessary any more, we can remove it by providing a
“remove” operation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/imeta.html">imeta</a></span><span class="op">(</span><span class="va">data_path</span>, operations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"add"</span>, attribute <span class="op">=</span> <span class="st">"size"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fake_data</span><span class="op">)</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"rows"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"add"</span>, attribute <span class="op">=</span> <span class="st">"size"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fake_data</span><span class="op">)</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"columns"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"remove"</span>, attribute <span class="op">=</span> <span class="st">"nrow"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fake_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">filter_ils</span><span class="op">(</span><span class="va">data_path</span>, <span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span>metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="multiple-operations-for-one-item">Multiple operations for one item<a class="anchor" aria-label="anchor" href="#multiple-operations-for-one-item"></a>
</h3>
<p>Since dataframes are lists of lists, the <code>operations</code>
argument of <code><a href="../reference/imeta.html">imeta()</a></code> can also be a dataframe. Say, for
example, that we have a standard set of metadata fields that we would
like to add to the linear model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  attribute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"size"</span>, <span class="st">"data_file"</span>, <span class="st">"model_type"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fake_data</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">data_path</span>, <span class="st">"linear regression"</span><span class="op">)</span>,</span>
<span>  units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observations"</span>, <span class="st">"predictors"</span>, <span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">lm_meta</span></span></code></pre></div>
<p>We can then just add a column with the operation name and add it to
our model data object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_meta</span><span class="op">$</span><span class="va">operation</span> <span class="op">&lt;-</span> <span class="st">"add"</span></span>
<span><span class="fu"><a href="../reference/imeta.html">imeta</a></span><span class="op">(</span><span class="va">lm_path</span>, operations <span class="op">=</span> <span class="va">lm_meta</span><span class="op">)</span></span>
<span><span class="fu">filter_ils</span><span class="op">(</span><span class="st">"linear_model"</span>, <span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="st">"analysis"</span>, metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="working-with-multiple-items">Working with multiple items<a class="anchor" aria-label="anchor" href="#working-with-multiple-items"></a>
</h3>
<p>If we want to add metadata to several items, however, we need to run
one <code><a href="../reference/imeta.html">imeta()</a></code> call per item, or loop over them with a
function such as <code>purrr:::pmap()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data_path</span>, <span class="va">lm_path</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dataframe"</span>, <span class="st">"lm"</span><span class="op">)</span>,</span>
<span>  responsible <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abby"</span>, <span class="st">"bob"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">pwalk</span><span class="op">(</span><span class="va">file_md</span>, <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">type</span>, <span class="va">responsible</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/imeta.html">imeta</a></span><span class="op">(</span><span class="va">path</span>, operations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      operation <span class="op">=</span> <span class="st">"add"</span>,</span>
<span>      attribute <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">type</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      operation <span class="op">=</span> <span class="st">"add"</span>,</span>
<span>      attribute <span class="op">=</span> <span class="st">"responsible"</span>,</span>
<span>      value <span class="op">=</span> <span class="va">responsible</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span>metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span><span class="st">"analysis"</span>, metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collections">Collections<a class="anchor" aria-label="anchor" href="#collections"></a>
</h3>
<p>Adding metadata to a collection follows the same procedure, but we do
need to specify the entity type. The reason we did not specify it for
data objects is that it’s the default value.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/imeta.html">imeta</a></span><span class="op">(</span></span>
<span>  <span class="st">"analysis"</span>,</span>
<span>  operations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>operation <span class="op">=</span> <span class="st">"add"</span>, attribute <span class="op">=</span> <span class="st">"dataset"</span>, value <span class="op">=</span> <span class="va">data_path</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ils.html">ils</a></span><span class="op">(</span>metadata<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="querying">Querying<a class="anchor" aria-label="anchor" href="#querying"></a>
</h2>
<p>We can query our collections and data objects based on their metadata
with <code><a href="../reference/iquery.html">iquery()</a></code> and providing a GenQuery statement with the
format <code>"SELECT COL1, COL2, COLN... (WHERE CONDITION)"</code>. In
this statement, “COL 1, COL2, COLN…” are names of columns in a database,
i.e. the properties we want to obtain, and the optional condition after
“WHERE” provides a filter based on the metadata of collections and data
objects.</p>
<p>For example, the query below asks for the names of the parent
collection and data objects of all the data objects that we have access
to:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iquery.html">iquery</a></span><span class="op">(</span><span class="st">"SELECT COLL_NAME, DATA_NAME"</span><span class="op">)</span></span></code></pre></div>
<p>The output is a dataframe with one row per result and one column per
information piece we requested (in this case the name of the collection
“COLL_NAME” and the name of the data object “DATA_NAME”). Note how the
query goes through all the levels of our file system.</p>
<p>The query below filters collections with a metadata attribute name
(“META_COLL_ATTR_NAME”) beginning with “data” and retrieves the names of
the collection and its data objects (“COLL_NAME” and “DATA_NAME”) as
well as the value of said metadata item (“META_COLL_ATTR_VALUE”).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iquery.html">iquery</a></span><span class="op">(</span><span class="st">"SELECT COLL_NAME, DATA_NAME, META_COLL_ATTR_VALUE WHERE META_COLL_ATTR_NAME LIKE 'data%'"</span><span class="op">)</span></span></code></pre></div>
<p>We could also retrieve other type of information such as the size of
a data object or the creation/modification time of a collection, a data
object or their metadata. For instance, the query below filters the data
objects that have a metadata attribute “size” (“META_DATA_ATTR_NAME =
‘size’”) and retrieves their actual size in bytes (“DATA_SIZE”) as well
as the value and units of the metadata attribute (“META_DATA_ATTR_VALUE”
and “META_DATA_ATTR_UNITS”).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iquery.html">iquery</a></span><span class="op">(</span><span class="st">"SELECT DATA_NAME, DATA_SIZE, META_DATA_ATTR_VALUE, META_DATA_ATTR_UNITS WHERE META_DATA_ATTR_NAME = 'size'"</span><span class="op">)</span></span></code></pre></div>
<p>Columns ending in “SIZE” are parsed to numbers; in the same way,
columns ending in “TIME” have the class “POSIXct”, i.e. as datetime
objects. As an example, the query below retrieves parent collection’s
name (“COLL_NAME”) and the name (“DATA_NAME”), creation time
(“DATA_CREATE_TIME”) and size in bytes (“DATA_SIZE”) of all data objects
whose parent collection name ends in “analysis” and that are less than
8000 bytes in size.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iquery.html">iquery</a></span><span class="op">(</span><span class="st">"SELECT COLL_NAME, DATA_NAME, DATA_CREATE_TIME, DATA_SIZE WHERE COLL_NAME LIKE '%analysis' AND DATA_SIZE &lt; '8000'"</span><span class="op">)</span></span>
<span><span class="va">iq</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">iq</span><span class="op">$</span><span class="va">DATA_CREATE_TIME</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">iq</span><span class="op">$</span><span class="va">DATA_SIZE</span><span class="op">)</span></span></code></pre></div>
<p>There are a number of columns that could be used for selection of
filtering. The ones that you’ll probably find most useful are shown in
the table below:</p>
<p>A final tip is that if you request the name of the parent collection
and of the data object themselves, you can concatenate them to obtain
their logical paths:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iq</span><span class="op">$</span><span class="va">PATH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">iq</span><span class="op">$</span><span class="va">COLL_NAME</span>, <span class="va">iq</span><span class="op">$</span><span class="va">DATA_NAME</span><span class="op">)</span></span>
<span><span class="va">iq</span></span></code></pre></div>
<p>Now you are ready to describe all your data with iRODS metadata and
find anything and everything with <code><a href="../reference/ils.html">ils()</a></code> and
<code><a href="../reference/iquery.html">iquery()</a></code>.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Schobben, Mariana Montes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
